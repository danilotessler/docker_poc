AWSTemplateFormatVersion: "2010-09-09"
Description: "ECS Web POC Project"
Parameters:
  ProjectName:
    Type: String
    Description: Project Name
  EnvironmentName:
    Type: String
    Description: Environment Name

Resources:
    ECRRepositoryWeb:
      Type: 'AWS::ECR::Repository'
      Properties:
        RepositoryName: !Sub "${ProjectName}/${EnvironmentName}/web"
        ImageTagMutability: MUTABLE   
        LifecyclePolicy:
          LifecyclePolicyText: |
            {
              "rules": [
                {
                  "rulePriority": 1,
                  "description": "Only keep 10 images",
                  "selection": {
                    "tagStatus": "any",
                    "countType": "imageCountMoreThan",
                    "countNumber": 10
                },
                "action": { "type": "expire" }
              }]
            }                 

    ECRRepositoryApi:
      Type: 'AWS::ECR::Repository'
      Properties:
        RepositoryName: !Sub "${ProjectName}/${EnvironmentName}/api"
        ImageTagMutability: MUTABLE   
        LifecyclePolicy:
          LifecyclePolicyText: |
            {
              "rules": [
                {
                  "rulePriority": 1,
                  "description": "Only keep 10 images",
                  "selection": {
                    "tagStatus": "any",
                    "countType": "imageCountMoreThan",
                    "countNumber": 10
                },
                "action": { "type": "expire" }
              }]
            }                    

    ECSClusterWeb:
        Type: "AWS::ECS::Cluster"
        Properties:
            ClusterName: !Sub "${ProjectName}_${EnvironmentName}_web"
            CapacityProviders: 
              - "FARGATE"
              - "FARGATE_SPOT"

    ECSClusterWeb:
        Type: "AWS::ECS::Cluster"
        Properties:
            ClusterName: !Sub "${ProjectName}_${EnvironmentName}_api"
            CapacityProviders: 
              - "FARGATE"
              - "FARGATE_SPOT"
              